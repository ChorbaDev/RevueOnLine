package MySQL;
import java.util.ArrayList;
import DAO.AbonnementDAO;
import Metier.*;
import java.sql.*;
import java.time.*;

public class MySQLAbonnement implements AbonnementDAO{
private MySQLAbonnement instance;
public MySQLAbonnement() {}
public MySQLAbonnement getInstance() {
	if(instance==null)
		instance=new MySQLAbonnement();
	return instance;	
}
	
	
	@Override
	public Abonnement getById(int id) throws SQLException {
		Connexion maConnexion=new Connexion();
		Connection connect=maConnexion.creeConnexion();	
		String sql="select date_debut, date_fin, id_client, id_revue from Abonnement where id_abonnement=?";
		PreparedStatement req=connect.prepareStatement(sql);
		ResultSet res=req.executeQuery();
		Abonnement abonnement=null;
		if(res.next()) {
			LocalDate dateDebut=res.getDate(1).toLocalDate();
			LocalDate dateFin=res.getDate(2).toLocalDate();
			abonnement=new Abonnement(id,dateDebut,dateFin,res.getInt(3),res.getInt(4));
		}
			
		if (res != null)
			res.close();
		if (req != null)
			req.close();
		if (connect != null)
			connect.close();
		
		return abonnement;
	}

	@Override
	public boolean create(Abonnement a) throws SQLException {
		Connexion maConnexion=new Connexion();
		Connection connect=maConnexion.creeConnexion();
		String sql="insert into Abonnement(date_debut,date_fin,id_client,id_revue) values (?,?,?,?)";
		PreparedStatement req=connect.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
		req.setDate(1,java.sql.Date.valueOf(a.getDate_debut()));
		req.setDate(2,java.sql.Date.valueOf(a.getDate_fin()));
		req.setInt(3, a.getId_client());
		req.setInt(4, a.getId_revue());
		int nbLignes=req.executeUpdate();
	    ResultSet res = req.getGeneratedKeys();
	    
	    if (res.next()) {
            a.setId(res.getInt(1));
        }
	    
	    if (res != null)
			res.close();
		if (req != null)
			req.close();
		if (connect != null)
			connect.close();
		
	    return nbLignes==1;
	}

	@Override
	public boolean update(Abonnement object) throws SQLException {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public boolean delete(Abonnement object) throws SQLException {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public ArrayList<Abonnement> getByClient(Client cl) throws SQLException {
		// TODO Auto-generated method stub
		return null;
	}
}
